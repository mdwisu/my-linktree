---
import { QrCode } from 'lucide-astro';
---

<div class="fixed bottom-4 left-4 z-50">
  <button
    id="qr-toggle"
    class="p-3 rounded-full glass-effect hover:scale-110 transition-all duration-200 group"
    aria-label="Show QR Code"
  >
    <QrCode class="w-5 h-5 text-gray-600 dark:text-gray-300" />
  </button>
</div>

<!-- QR Code Modal -->
<div id="qr-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
  <div class="glass-effect rounded-2xl p-6 max-w-sm w-full text-center">
    <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">
      Scan QR Code
    </h3>
    <div id="qr-container" class="bg-white p-4 rounded-lg mx-auto mb-4 w-fit">
      <!-- QR code will be generated here -->
    </div>
    <p class="text-sm text-gray-600 dark:text-gray-300 mb-4">
      Scan to visit this page
    </p>
    <button
      id="qr-close"
      class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
    >
      Close
    </button>
  </div>
</div>

<script>
  // Simple QR Code generator using API
  const generateQR = (text: string) => {
    return `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(text)}`;
  };

  const qrToggle = document.getElementById('qr-toggle');
  const qrModal = document.getElementById('qr-modal');
  const qrClose = document.getElementById('qr-close');
  const qrContainer = document.getElementById('qr-container');

  qrToggle?.addEventListener('click', () => {
    const currentUrl = window.location.href;
    if (qrContainer) {
      qrContainer.innerHTML = `<img src="${generateQR(currentUrl)}" alt="QR Code" class="w-48 h-48 mx-auto" />`;
    }
    qrModal?.classList.remove('hidden');
    qrModal?.classList.add('flex');
  });

  qrClose?.addEventListener('click', () => {
    qrModal?.classList.add('hidden');
    qrModal?.classList.remove('flex');
  });

  qrModal?.addEventListener('click', (e) => {
    if (e.target === qrModal) {
      qrModal?.classList.add('hidden');
      qrModal?.classList.remove('flex');
    }
  });
</script>